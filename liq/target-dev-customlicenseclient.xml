<project name="dev-customlicenseclient" default="warning">
    <property name="deploy-dir" value="deploy/target/${ant.project.name}" />
    <property name="app-name" value="L-iQ PS client" />
	
    <target name="warning">
        <echo message="Please run top level build." />
    </target>
    
    <target name="deploy">
        <mkdir dir="${deploy-dir}" />
        <copy todir="${deploy-dir}">
            <fileset dir="lib/felix/1.4.1">
                <include name="**" />
            </fileset>
        </copy>
        <copy todir="${deploy-dir}/bundle">
            <fileset dir="deploy/bundle">
                <include name="net.luminis.liq.consolelogger-1.0.0.jar" />
            	<include name="net.luminis.liq.scheduler-1.0.0.jar" />
            	<include name="net.luminis.liq.configurator-1.0.0.jar" />
            	<include name="net.luminis.liq.configurator.useradmin.task-1.0.0.jar" />
            	<include name="net.luminis.liq.resourceprocessor.useradmin-1.0.0.jar" />
            	<include name="net.luminis.liq.discovery.property-1.0.0.jar" />
            	<include name="net.luminis.liq.server.log.store-1.0.0.jar" />
            	<include name="net.luminis.liq.server.log.task-1.0.0.jar" />
            	<include name="net.luminis.liq.repository-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repositoryuseradmin-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repository.stateful-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repository-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repository.helper.base-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repository.helper.bundle-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repository.helper.driverbundle-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repository.helper.configuration-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repository.helper.user-1.0.0.jar" />
            	<include name="net.luminis.liq.client.repository.helper.license-1.0.0.jar" />
                <include name="net.luminis.liq.activation.store-1.0.0.jar" />
                <include name="net.luminis.liq.activationinfo.store-1.0.0.jar" />
                <include name="net.luminis.liq.activation.matcher-1.0.0.jar" />
            	<include name="net.luminis.liq.swingui.resources-1.0.0.jar" />
            	<include name="net.luminis.liq.swingui.resources.en-1.0.0.jar" />
            	<include name="net.luminis.liq.swingui.resources.nl-1.0.0.jar" />
            	<include name="net.luminis.liq.swingui.skin-1.0.0.jar" />
            	<include name="net.luminis.liq.swingui-1.0.0.jar" />
            </fileset>
            <fileset dir="ext">
            	<include name="org.osgi.compendium.jar" />
                <include name="osgi.mobile.jar" />
                <include name="javax.servlet.jar" />
                <include name="org.apache.felix.dependencymanager.jar" />
                <include name="org.apache.felix.dependencymanager.shell.jar" />
                <include name="forms-1.0.7.jar" />
                <include name="swingx-2007_03_18.jar" />
                <include name="SwingHelper.jar" />
                <include name="xstream-1.3.jar" />
                <include name="miglayout15-swing.jar" />
            </fileset>
            <fileset dir="lib">
                <include name="org.apache.felix.configadmin.jar" />
                <include name="log_all-2.0.0.jar" />
            	<include name="useradmin_all-2.0.0.jar" />
            	<include name="net.luminis.liq.xstream-1.3.jar" />
                <include name="org.apache.felix.eventadmin.jar" />
            	<include name="org.apache.felix.prefs.jar" />
            </fileset>
    	</copy>
        <copy todir="${deploy-dir}/conf">
            <fileset dir="conf/${ant.project.name}">
                <include name="**/*.cfg" />
            </fileset>
        </copy>
        <move file="${deploy-dir}/conf/dev-config.properties" tofile="${deploy-dir}/conf/config.properties" />
        <delete file="${deploy-dir}/conf/test-config.properties" />
        <replace file="${deploy-dir}/conf/config.properties" token="@bundles@" value="
        	file:bundle/net.luminis.liq.consolelogger-1.0.0.jar
            file:bundle/javax.servlet.jar
            file:bundle/org.osgi.compendium.jar 
            file:bundle/osgi.mobile.jar 
            file:bundle/org.apache.felix.dependencymanager.jar 
            file:bundle/org.apache.felix.dependencymanager.shell.jar 
            file:bundle/org.apache.felix.shell-1.0.2.jar 
            file:bundle/org.apache.felix.shell.tui-1.0.2.jar 
            file:bundle/org.apache.felix.configadmin.jar
        	file:bundle/org.apache.felix.eventadmin.jar
            file:bundle/org.apache.felix.prefs.jar
        	file:bundle/useradmin_all-2.0.0.jar
        	file:bundle/log_all-2.0.0.jar
            file:bundle/net.luminis.liq.scheduler-1.0.0.jar
        	file:bundle/net.luminis.liq.configurator-1.0.0.jar
        	file:bundle/net.luminis.liq.resourceprocessor.useradmin-1.0.0.jar
        	file:bundle/net.luminis.liq.configurator.useradmin.task-1.0.0.jar
        	file:bundle/net.luminis.liq.client.repositoryuseradmin-1.0.0.jar
            file:bundle/net.luminis.liq.discovery.property-1.0.0.jar
            file:bundle/net.luminis.liq.server.log.store-1.0.0.jar
            file:bundle/net.luminis.liq.server.log.task-1.0.0.jar
            file:bundle/net.luminis.liq.repository-1.0.0.jar
            file:bundle/net.luminis.liq.client.repository.stateful-1.0.0.jar
        	file:bundle/net.luminis.liq.client.repository-1.0.0.jar
        	file:bundle/net.luminis.liq.client.repository.helper.base-1.0.0.jar
        	file:bundle/net.luminis.liq.client.repository.helper.bundle-1.0.0.jar
        	file:bundle/net.luminis.liq.client.repository.helper.driverbundle-1.0.0.jar
        	file:bundle/net.luminis.liq.client.repository.helper.configuration-1.0.0.jar
        	file:bundle/net.luminis.liq.client.repository.helper.user-1.0.0.jar
            file:bundle/net.luminis.liq.client.repository.helper.license-1.0.0.jar
            file:bundle/net.luminis.liq.activationinfo.store-1.0.0.jar
        	file:bundle/net.luminis.liq.activation.store-1.0.0.jar
        	file:bundle/net.luminis.liq.activation.matcher-1.0.0.jar
        	file:bundle/net.luminis.liq.xstream-1.3.jar
        	file:bundle/net.luminis.liq.swingui.resources-1.0.0.jar
        	file:bundle/net.luminis.liq.swingui.resources.en-1.0.0.jar
        	file:bundle/net.luminis.liq.swingui.resources.nl-1.0.0.jar
        	file:bundle/net.luminis.liq.swingui.skin-1.0.0.jar
        	file:bundle/net.luminis.liq.swingui-1.0.0.jar" />
        <replace file="${deploy-dir}/conf/config.properties" token="@properties@" value="" />
    	
    	<property name="vmargs" value="-Dorg.knopflerfish.useradmin.dontsave=true -Dorg.apache.felix.eventadmin.Timeout=0" />
    	
    	<property name="runCommand" value="java ${vmargs} -jar bin/felix.jar"/>
    	<property name="runNlCommand" value="java -Duser.language=nl ${vmargs} -jar bin/felix.jar"/>
    	<property name="debugCommand" value="java ${vmargs} -jar -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=y -Dcom.sun.management.jmxremote.port=6666 -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false bin/felix.jar"/>
    	<echo file="${deploy-dir}/run.sh">#!/bin/sh
${runCommand}
        </echo>
		<echo file="${deploy-dir}/run.bat">${runCommand}
        </echo>
		<echo file="${deploy-dir}/run_nl.sh">#!/bin/sh
${runNlCommand}
        </echo>
		<echo file="${deploy-dir}/run_nl.bat">${runNlCommand}
        </echo>
        <echo file="${deploy-dir}/debug.sh">#!/bin/sh
${debugCommand}
        </echo>
        <echo file="${deploy-dir}/debug.bat">${debugCommand}
        </echo>
    </target>
</project>